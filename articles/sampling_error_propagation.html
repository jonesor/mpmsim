<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Sampling error and its propagation ‚Ä¢ mpmsim</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Sampling error and its propagation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mpmsim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/generating_lefkovitch_models.html">Generating Lefkovitch models</a></li>
    <li><a class="dropdown-item" href="../articles/generating_leslie_models.html">Generating Leslie models</a></li>
    <li><a class="dropdown-item" href="../articles/sampling_error_propagation.html">Sampling error and its propagation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jonesor/mpmsim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Sampling error and its propagation</h1>
            
            <h4 data-toc-skip class="date">2025-03-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jonesor/mpmsim/blob/main/vignettes/sampling_error_propagation.Rmd" class="external-link"><code>vignettes/sampling_error_propagation.Rmd</code></a></small>
      <div class="d-none name"><code>sampling_error_propagation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Uncertainty in the individual elements of a matrix population model
(MPM) can propagate, affecting the accuracy of metrics derived from the
model, such as population growth rate, generation time, etc.</p>
<p>One approach to estimate this uncertainty is parametric
bootstrapping, a resampling method that explicitly assumes statistical
distributions for matrix elements and generates a range of possible
matrices based on these assumptions. For example, reproductive output
can be modelled as a Poisson-distributed process, suitable for
count-based data, while survival can be represented by a binomial
distribution, reflecting the probability of individual survival. These
assumptions allow for more realistic variability in parameter estimates
compared to nonparametric methods. Note that this approach does not
assume that the initial matrices represent the ‚Äútrue‚Äù parameters;
rather, it treats them as estimates with associated uncertainty. The
parametric bootstrap is used precisely to quantify this uncertainty by
resampling based on these estimated parameters.</p>
<p>The <code>compute_ci</code> function uses parametric bootstrapping to
estimate a 95% confidence interval (95% CI) for any MPM-derived metric.
Specifically, it repeatedly samples matrix elements from their assumed
distributions, generating a sampling distribution of the metric of
interest. The 95% CI is calculated from the 2.5th and 97.5th percentiles
of this distribution, providing an empirical range that quantifies
uncertainty.</p>
<p>The width and shape of the sampling distribution‚Äîand consequently,
the confidence intervals‚Äîare influenced by several factors, including
the sample size used for estimating matrix elements, the matrix model‚Äôs
structure, the assumptions underlying the <code>compute_ci</code>
function, and the distribution of uncertainties across matrix elements.
A narrower confidence interval indicates greater precision, but this
precision depends on the quality of the underlying assumptions. To
accurately assess the reliability of MPM estimates, it is necessary to
carefully consider these factors when interpreting the results.</p>
<p>The following examples show how to use these functions.</p>
</div>
<div class="section level2">
<h2 id="aims">Aims<a class="anchor" aria-label="anchor" href="#aims"></a>
</h2>
<p>The purpose of this vignette is to illustrate how to use
<code>mpmsim</code> to assess and estimate sampling error in MPMs and
how this uncertainty propagates into derived metrics. This approach is
useful for several reasons, including:</p>
<ul>
<li>Estimating confidence intervals (CIs) for key demographic metrics,
such as population growth rate using parametric bootstrapping
methods.</li>
<li>Exploring the impact of sample size on the precision of estimates
for population growth rate and other metrics derived from MPMs.</li>
<li>Evaluating the propagation of uncertainty across different matrix
elements and submatrices (survival/growth vs.¬†reproduction) in
MPMs.</li>
</ul>
</div>
<div class="section level2">
<h2 id="estimate-95-confidence-intervals">Estimate 95% Confidence Intervals<a class="anchor" aria-label="anchor" href="#estimate-95-confidence-intervals"></a>
</h2>
<p>We can estimate the 95% CI for any metric derived from a matrix
population model. In this example, we focus on the population growth
rate,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>.</p>
<p>Consider a matrix model <strong>A</strong>, which is composed of
submatrices <strong>U</strong> (survival/growth) and <strong>F</strong>
(sexual reproduction), such that <strong>A</strong> = <strong>U</strong>
+ <strong>F</strong>.</p>
<p>The methods require that the matrix model be split into its component
submatrices because the underlying processes are governed by
distributions with different statistical properties: individual survival
is treated as a binary process (0 = dies, 1 = survives), whereas
individual reproduction follows a Poisson distribution.</p>
<p>In this example, the matrix is simple, with only the top-right
element representing reproduction, while all other elements represent
survival or growth. The method assumes that the matrices represent the
true values, for which we wish to calculate confidence intervals.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùêÄ</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mn>0.1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>5.0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>0.2</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0.4</mn><mspace width="0.222em"></mspace></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">
\mathbf{A} = \begin{bmatrix}
0.1 &amp; 5.0 \\
0.2 &amp; 0.4 \
\end{bmatrix}
</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùêî</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mn>0.1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0.0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>0.2</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0.4</mn><mspace width="0.222em"></mspace></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">
\mathbf{U} = \begin{bmatrix}
0.1 &amp; 0.0 \\
0.2 &amp; 0.4 \
\end{bmatrix}
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùêÖ</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mn>0.0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>5.0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>0.0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0.0</mn><mspace width="0.222em"></mspace></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">
\mathbf{F} = \begin{bmatrix}
0.0 &amp; 5.0 \\
0.0 &amp; 0.0 \
\end{bmatrix}
</annotation></semantics></math></p>
<p>We can enter these matrices into R as follows, first entering the
<strong>U</strong> and <strong>F</strong> matrices, and then summing
them to get the <strong>A</strong> matrix.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matU</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">0.1</span>, <span class="fl">0.0</span>,</span>
<span>  <span class="fl">0.2</span>, <span class="fl">0.4</span></span>
<span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">matF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">0.0</span>, <span class="fl">5.0</span>,</span>
<span>  <span class="fl">0.0</span>, <span class="fl">0.0</span></span>
<span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">matA</span> <span class="op">&lt;-</span> <span class="va">matU</span> <span class="op">+</span> <span class="va">matF</span></span></code></pre></div>
<p>The estimated population growth rate
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>)
can be calculated using the <code>eigs</code> function from the
<code>popdemo</code> package like this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">popdemo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/popdemo/man/eigs.html" class="external-link">eigs</a></span><span class="op">(</span><span class="va">matA</span>, what <span class="op">=</span> <span class="st">"lambda"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.261187</span></span></code></pre></div>
<p>We can now estimate the 95% CI for this estimate, based on a
knowledge of the sample size(s) used to parameterise the MPM.</p>
<p>If the sample size used to estimate each element of the matrix is
<code>20</code> individuals, we can estimate the 95% CI for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
using the <code>compute_ci</code> function. This function requires
several arguments: <code>mat_U</code> and <code>mat_F</code> represent
the survival/growth matrix and reproductive output matrix respectively,
and <code>sample_size</code> specifies the number of individuals used to
estimate each element (in this case, <code>20</code>). The argument
<code>FUN</code> defines the function to be applied to the resulting
<strong>A</strong> matrix to calculate the desired metric.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/compute_ci.html">compute_ci</a></span><span class="op">(</span></span>
<span>  mat_U <span class="op">=</span> <span class="va">matU</span>, mat_F <span class="op">=</span> <span class="va">matF</span>, sample_size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  FUN <span class="op">=</span> <span class="fu">popdemo</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/popdemo/man/eigs.html" class="external-link">eigs</a></span>, what <span class="op">=</span> <span class="st">"lambda"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;      2.5%     97.5% </span></span>
<span><span class="co">#&gt; 0.7097788 1.7020301</span></span></code></pre></div>
<p>We can examine the sampling distribution of these
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
estimates by using the argument <code>dist.out = TRUE</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distLambda_20</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_ci.html">compute_ci</a></span><span class="op">(</span></span>
<span>  mat_U <span class="op">=</span> <span class="va">matU</span>, mat_F <span class="op">=</span> <span class="va">matF</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">20</span>, FUN <span class="op">=</span> <span class="fu">popdemo</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/popdemo/man/eigs.html" class="external-link">eigs</a></span>, what <span class="op">=</span> <span class="st">"lambda"</span>,</span>
<span>  dist.out <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">distLambda_20</span><span class="op">$</span><span class="va">estimates</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_error_propagation_files/figure-html/unnamed-chunk-5-1.png" alt="Histogram of lambda estimates with a sample size of 20" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="sample-sizes-that-vary-across-the-mpm">Sample sizes that vary across the MPM<a class="anchor" aria-label="anchor" href="#sample-sizes-that-vary-across-the-mpm"></a>
</h2>
<p>In the above example, it is assumed that the sample size used to make
the parameter estimates (i.e.¬†each element of the matrix model) was the
same throughout the model. However, sample size might vary across
different parts of the matrix or submatrices due to variations in data
availability or biological processes. For example, data on survival and
growth (represented in the <strong>U</strong> matrix) might be more
abundant because these processes can often be tracked more easily in
field studies. In contrast, reproductive output data (represented in the
<strong>F</strong> matrix) may be harder to collect, especially for
species with complex reproductive cycles, leading to smaller sample
sizes. Additionally, environmental factors or study limitations can
result in unequal sampling efforts across different life stages,
contributing to varying sample sizes in the matrix elements.</p>
<p>To account for this, the <code>compute_ci</code> function allows
flexibility in specifying sample size, which can be added in several
ways to control how variability is modelled across different parts of
the matrix. As an alternative to providing a single value to apply
uniformly to all elements (as done above) you can provide a matrix
specifying sample sizes for each element, or a list of matrices for
distinct components (e.g., <strong>U</strong> and <strong>F</strong>
matrices). This flexibility helps tailor the modelling of uncertainty to
reflect different data availability across biological processes.</p>
<p>For instance, in the following code, we use the same MPM as above,
split into <strong>U</strong> and <strong>F</strong> submatrices
(<code>matU</code> and <code>matF</code>, respectively), but now assume
that sample size varies between these components, with <code>40</code>
individuals for <strong>U</strong> and <code>15</code> for
<strong>F</strong>. Here, the sample size is consistent across all
elements within the <strong>U</strong> matrix, but you could also assign
different sample sizes to individual elements of the matrix, allowing
for different sample sizes for different transitions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the sample sizes for U</span></span>
<span><span class="va">mat_U_ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">40</span>, <span class="fl">40</span>,</span>
<span>  <span class="fl">40</span>, <span class="fl">40</span></span>
<span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define sample sizes for F</span></span>
<span><span class="va">mat_F_ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">0.0</span>, <span class="fl">15</span>,</span>
<span>  <span class="fl">0.0</span>, <span class="fl">0.0</span></span>
<span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine sample sizes into list</span></span>
<span><span class="va">sampleSizes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mat_U_ss <span class="op">=</span> <span class="va">mat_U_ss</span>, mat_F_ss <span class="op">=</span> <span class="va">mat_F_ss</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate CI for lambda</span></span>
<span><span class="fu"><a href="../reference/compute_ci.html">compute_ci</a></span><span class="op">(</span></span>
<span>  mat_U <span class="op">=</span> <span class="va">matU</span>, mat_F <span class="op">=</span> <span class="va">matF</span>, sample_size <span class="op">=</span> <span class="va">sampleSizes</span>,</span>
<span>  FUN <span class="op">=</span> <span class="fu">popdemo</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/popdemo/man/eigs.html" class="external-link">eigs</a></span>, what <span class="op">=</span> <span class="st">"lambda"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;     2.5%    97.5% </span></span>
<span><span class="co">#&gt; 0.895995 1.579860</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exploring-the-impact-of-sample-size">Exploring the impact of sample size<a class="anchor" aria-label="anchor" href="#exploring-the-impact-of-sample-size"></a>
</h2>
<p>Sample size is critical in determining the precision of statistical
estimates. In demographic studies, small sample sizes can lead to high
uncertainty in estimates of derived measures like
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>,
making it difficult to make strong inferences. Larger sample sizes
reduce this uncertainty, as seen in the narrower confidence intervals
around
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
when we increase the sample size from 20 (calculated above) to 100
(below).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distLambda_100</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_ci.html">compute_ci</a></span><span class="op">(</span></span>
<span>  mat_U <span class="op">=</span> <span class="va">matU</span>, mat_F <span class="op">=</span> <span class="va">matF</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">100</span>, FUN <span class="op">=</span> <span class="fu">popdemo</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/popdemo/man/eigs.html" class="external-link">eigs</a></span>, what <span class="op">=</span> <span class="st">"lambda"</span>,</span>
<span>  dist.out <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">distLambda_20</span><span class="op">$</span><span class="va">estimates</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.75</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">distLambda_100</span><span class="op">$</span><span class="va">estimates</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.75</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_error_propagation_files/figure-html/compareDist2-1.png" alt="Histograms of lambda estimates with a sample size of 20 and 100" width="576" style="display: block; margin: auto;"></p>
<p>This approach can be used to perform a form of power analysis by
simulation, a technique for determining the sample size required to
detect an effect with a specified statistical power and significance
level. For instance, one might ask, ‚ÄôWhat sample size is needed to
confidently conclude that the population growth rate is above 1.0?</p>
<p>The following code creates a plot to visualize how the precision of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
estimates improves as sample size increases. It first defines a set of
sample sizes to iterate over, then it uses <code>compute_ci</code> to
calculate the confidence intervals (CIs) for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
estimated from MPMs based on these sample sizes. It then plots
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
estimates and their CIs, along with a reference line at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œª</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\lambda = 1</annotation></semantics></math>.
The goal is to show that as the sample size increases, the width of the
CIs shrinks, increasing our confidence in the value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>.</p>
<p>In this case, a sample size of approximately 70 appears sufficient.
However, sample size likely has greater importance for the more elastic
elements of the MPM. Therefore, focusing on these elements could help
users better understand the specific sample size requirements for their
system. This targeted approach would lead to a more nuanced study
design, allowing for optimized sampling efforts in the areas where
precision matters most.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define sample sizes to iterate over</span></span>
<span><span class="va">sample_sizes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Lambda value for reference</span></span>
<span><span class="va">matA</span> <span class="op">&lt;-</span> <span class="va">matF</span> <span class="op">+</span> <span class="va">matU</span></span>
<span><span class="va">true_lambda</span> <span class="op">&lt;-</span> <span class="fu">popdemo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/popdemo/man/eigs.html" class="external-link">eigs</a></span><span class="op">(</span><span class="va">matA</span>, what <span class="op">=</span> <span class="st">"lambda"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize an empty data frame with predefined columns</span></span>
<span><span class="va">ci_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  sample_size <span class="op">=</span> <span class="va">sample_sizes</span>,</span>
<span>  ci_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sample_sizes</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ci_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sample_sizes</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  estimate_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sample_sizes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop through each sample size and calculate the CI for lambda</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">sample_sizes</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">sample_sizes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># Compute CI for the current sample size</span></span>
<span>  <span class="va">dist_lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_ci.html">compute_ci</a></span><span class="op">(</span></span>
<span>    mat_U <span class="op">=</span> <span class="va">matU</span>, mat_F <span class="op">=</span> <span class="va">matF</span>,</span>
<span>    sample_size <span class="op">=</span> <span class="va">n</span>, FUN <span class="op">=</span> <span class="fu">popdemo</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/popdemo/man/eigs.html" class="external-link">eigs</a></span>, what <span class="op">=</span> <span class="st">"lambda"</span>,</span>
<span>    dist.out <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Calculate 95% CI from the distribution</span></span>
<span>  <span class="va">ci_results</span><span class="op">$</span><span class="va">ci_lower</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">dist_lambda</span><span class="op">$</span><span class="va">estimates</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>  <span class="va">ci_results</span><span class="op">$</span><span class="va">ci_upper</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">dist_lambda</span><span class="op">$</span><span class="va">estimates</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span>  <span class="va">ci_results</span><span class="op">$</span><span class="va">estimate_mean</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dist_lambda</span><span class="op">$</span><span class="va">estimates</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Calculate error bars</span></span>
<span><span class="va">ci_lower_error</span> <span class="op">&lt;-</span> <span class="va">ci_results</span><span class="op">$</span><span class="va">estimate_mean</span> <span class="op">-</span> <span class="va">ci_results</span><span class="op">$</span><span class="va">ci_lower</span></span>
<span><span class="va">ci_upper_error</span> <span class="op">&lt;-</span> <span class="va">ci_results</span><span class="op">$</span><span class="va">ci_upper</span> <span class="op">-</span> <span class="va">ci_results</span><span class="op">$</span><span class="va">estimate_mean</span></span>
<span></span>
<span><span class="co"># Create the plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/popdemo/man/Projection-plots.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ci_results</span><span class="op">$</span><span class="va">sample_size</span>, <span class="va">ci_results</span><span class="op">$</span><span class="va">estimate_mean</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">ci_results</span><span class="op">$</span><span class="va">ci_lower</span>, <span class="va">ci_results</span><span class="op">$</span><span class="va">ci_upper</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span>, xlab <span class="op">=</span> <span class="st">"Sample Size"</span>, ylab <span class="op">=</span> <span class="st">"Lambda Estimate"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Effect of Sample Size on Lambda Estimate Precision"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add error bars and reference line</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span><span class="va">ci_results</span><span class="op">$</span><span class="va">sample_size</span>, <span class="va">ci_results</span><span class="op">$</span><span class="va">ci_lower</span>,</span>
<span>  <span class="va">ci_results</span><span class="op">$</span><span class="va">sample_size</span>, <span class="va">ci_results</span><span class="op">$</span><span class="va">ci_upper</span>,</span>
<span>  angle <span class="op">=</span> <span class="fl">90</span>, code <span class="op">=</span> <span class="fl">3</span>, length <span class="op">=</span> <span class="fl">0.05</span>, col <span class="op">=</span> <span class="st">"blue"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">1</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_error_propagation_files/figure-html/poweranalysis-1.png" alt="Effect of Sample Size on Lambda Estimate Precision" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This vignette demonstrates how sampling error propagates through
MPMs, influencing metrics like population growth rate, and provides a
practical method for estimating confidence intervals for these metrics
using <code>compute_ci</code>. By applying tools like
<code>compute_ci</code>, users can also evaluate the effect of sample
size on estimate precision, using this information to optimize data
collection efforts and improve the reliability of demographic
estimates.</p>
</div>
<div class="section level2">
<h2 id="addendum">Addendum<a class="anchor" aria-label="anchor" href="#addendum"></a>
</h2>
<p>The <code>compute_ci</code> function is intended for metrics that
rely on the full <strong>A</strong> matrix. However, some metrics, like
<code>life_expect_mean</code> from the <code>Rage</code> package, only
require the <strong>U</strong> matrix. For metrics such as these, users
should use the <code>compute_ci_U</code> function, which works similarly
to <code>compute_ci</code>, but is specifically designed for metrics
that focus solely on survival and growth processes within the
<strong>U</strong> matrix.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Owen Jones.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
