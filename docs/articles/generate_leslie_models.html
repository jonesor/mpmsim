<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Generating Leslie matrices • mpmsim</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generating Leslie matrices">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mpmsim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/error_propagation.html">Sampling error and its propagation</a></li>
    <li><a class="dropdown-item" href="../articles/generate_lefkovitch_models.html">Generating Lefkovitch matrices</a></li>
    <li><a class="dropdown-item" href="../articles/generate_leslie_models.html">Generating Leslie matrices</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jonesor/mpmsim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generating Leslie matrices</h1>
            
            <h4 data-toc-skip class="date">2024-10-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jonesor/mpmsim/blob/HEAD/vignettes/generate_leslie_models.Rmd" class="external-link"><code>vignettes/generate_leslie_models.Rmd</code></a></small>
      <div class="d-none name"><code>generate_leslie_models.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Leslie matrix models, named after Patrick Leslie who introduced them
in the 1940s, are a type of matrix population model (MPM) used to
describe the demography of age-structured populations. They are commonly
used in studies of wildlife, conservation and evolutionary biology.</p>
<p>In a Leslie MPM, the square matrix is used to model discrete,
age-structured population growth with a projection interval, most often
representing years, as a time step. Each element in the matrix
represents a transition probability between different age classes or
indicates the average reproductive output (often referred to as
fecundity in population biology and fertility in human demography) of
the age class. The information in the MPM can be split into two
submatrices, representing survival/growth and reproduction,
respectively.</p>
<ul>
<li><p><strong>Survival Probabilities</strong>: The subdiagonal
(immediately below the main diagonal) of the MPM consists of survival
probabilities. Each entry here shows the probability that an individual
of one age class will survive to the next age class. These probabilities
can be understood as an age trajectory of survival that can be modelled
using a mathematical model describing how age-specific mortality changes
with age.</p></li>
<li><p><strong>Reproductive Output</strong>: The first row of the MPM
contains the reproductive output of each age class, representing the
number of new individuals produced in each projection interval. This is
often referred to as fecundity in ecological contexts.</p></li>
</ul>
<p>All other entries in the MPM are typically zero, indicating that
those transitions are impossible.</p>
<p>To project the population size and structure through time, the MPM is
multiplied by a vector that represents the current population structure
(number of individuals in each age class). This process results in a new
vector that shows the predicted structure of the population in the next
time step. This calculation can be iterated repeatedly to project
population and structure through time.</p>
<p>Leslie matrices are useful for studying population dynamics under
different scenarios, such as changes in survival rates, fecundity rates,
or management strategies. They have been widely applied in both
theoretical and applied ecology.</p>
</div>
<div class="section level2">
<h2 id="aims">Aims<a class="anchor" aria-label="anchor" href="#aims"></a>
</h2>
<p>The aim of this vignette is to demonstrate how to simulate Leslie
matrix population models (MPMs) using functional forms for mortality and
reproduction. This simulation is useful for various purposes,
including:</p>
<ul>
<li>Investigating the influence of senescence parameters on population
dynamics.</li>
<li>Generating MPMs based on empirical parameter estimates of mortality
and reproduction from the literature.</li>
<li>Creating MPMs with specific properties for educational and research
purposes.</li>
</ul>
<p>In the following sections, this document will:</p>
<ol style="list-style-type: decimal">
<li>Explain the basics of mortality and reproduction trajectories.</li>
<li>Show how to produce life tables reflecting trajectories of mortality
and reproduction.</li>
<li>Show how to produce MPMs from these life tables.</li>
<li>Show how to generate sets of many MPMs based on defined mortality
and reproduction characteristics.</li>
</ol>
</div>
<div class="section level2">
<h2 id="preparation">Preparation<a class="anchor" aria-label="anchor" href="#preparation"></a>
</h2>
<p>Before beginning, users will need to load the required packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonesor/mpmsim" class="external-link">mpmsim</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonesor/Rage" class="external-link">Rage</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonesor/Rcompadre" class="external-link">Rcompadre</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="functional-forms-of-mortality-and-reproduction">1. Functional forms of mortality and reproduction<a class="anchor" aria-label="anchor" href="#functional-forms-of-mortality-and-reproduction"></a>
</h2>
<p>There are numerous published and well-used functional forms used to
describe how mortality risk (hazard) changes with age. The
<code>model_mortality</code> function (and its synonym
<code>model_survival</code>) handles 6 of these models: Gompertz,
Gompertz-Makeham, Weibull, Weibull-Makeham, Siler and Exponential.</p>
<p>In a nutshell:</p>
<ul>
<li>Gompertz: A mortality rate that increases exponentially with age.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>x</mi></msub><mo>=</mo><msub><mi>b</mi><mn>0</mn></msub><msup><mi mathvariant="normal">e</mi><mrow><msub><mi>b</mi><mn>1</mn></msub><mi>x</mi></mrow></msup></mrow><annotation encoding="application/x-tex">h_x = b_0 \mathrm{e}^{b_1  x}</annotation></semantics></math>
</li>
<li>Gompertz-Makeham: A mortality rate that increases exponentially with
age, with an additional age-independent constant mortality.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>x</mi></msub><mo>=</mo><msub><mi>b</mi><mn>0</mn></msub><msup><mi mathvariant="normal">e</mi><mrow><msub><mi>b</mi><mn>1</mn></msub><mi>x</mi></mrow></msup><mo>+</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">h_x = b_0 \mathrm{e}^{b_1  x} + c</annotation></semantics></math>
</li>
<li>Weibull: A mortality rate that scales with age, increasing at a rate
that can either accelerate or decelerate, depending on the parameters of
the model.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>x</mi></msub><mo>=</mo><msub><mi>b</mi><mn>0</mn></msub><msub><mi>b</mi><mn>1</mn></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>b</mi><mn>1</mn></msub><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>b</mi><mn>0</mn></msub><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">h_x = b_0  b_1  (b_1  x)^(b_0 - 1)</annotation></semantics></math>
</li>
<li>Weibull-Makeham: as the basic Weibull, but with an additional
age-independent constant mortality.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>x</mi></msub><mo>=</mo><msub><mi>b</mi><mn>0</mn></msub><msub><mi>b</mi><mn>1</mn></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>b</mi><mn>1</mn></msub><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>b</mi><mn>0</mn></msub><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>+</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">h_x = b_0  b_1  (b_1  x)^(b_0 - 1) + c</annotation></semantics></math>
</li>
<li>Siler: A mortality model that separates mortality rates into two
age-related components — juvenile mortality, which declines
exponentially with age and adult mortality, which increases
exponentially.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>x</mi></msub><mo>=</mo><msub><mi>a</mi><mn>0</mn></msub><msup><mi mathvariant="normal">e</mi><mrow><mi>−</mi><msub><mi>a</mi><mn>1</mn></msub><mi>x</mi></mrow></msup><mo>+</mo><mi>c</mi><mo>+</mo><msub><mi>b</mi><mn>0</mn></msub><msup><mi mathvariant="normal">e</mi><mrow><msub><mi>b</mi><mn>1</mn></msub><mi>x</mi></mrow></msup></mrow><annotation encoding="application/x-tex">h_x = a_0 \mathrm{e}^{-a_1  x} + c + b_0 \mathrm{e}^{b_1 x}</annotation></semantics></math>
</li>
<li>Exponential: Constant mortality that is unchanging with age.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>x</mi></msub><mo>=</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">h_x = c</annotation></semantics></math>
</li>
</ul>
<p>These are illustrated below.</p>
<p><img src="generate_leslie_models_files/figure-html/unnamed-chunk-2-1.png" width="768"></p>
<p>In addition to these functional forms of mortality, there are, of
course, functional forms that have been used to model reproductive
output. The <code>model_reproduction</code> function (and its synonyms
<code>model_fedundity</code> and <code>model_fertility</code>) handles
five types: logistic, step, von Bertalanffy, normal and Hadwiger.</p>
<ul>
<li>Logistic: Reproductive output initially increases rapidly with age
then slows to plateau as it approaches a maximum value.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>x</mi></msub><mo>=</mo><mi>A</mi><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mi>e</mi><mi>x</mi><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mi>k</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>−</mo><msub><mi>x</mi><mi>m</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_x = A / (1 + exp(-k  (x - x_m)))</annotation></semantics></math>
</li>
<li>Step: Reproductive output is initially zero, then jumps to a
particular level at a specified age, after which it remains constant.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>x</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mi>A</mi><mo>,</mo><mi>x</mi><mo>≥</mo><mi>m</mi></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mi>A</mi><mo>,</mo><mi>x</mi><mo>&lt;</mo><mi>m</mi></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">f_x= \begin{cases} A, x \geq m \\ A, x &lt;  m \end{cases}</annotation></semantics></math>
</li>
<li>von Bertalanffy: This model is often used in growth dynamics but has
been adapted for reproduction to describe changes over age or time
following a logistic growth form not limited by a strict upper
asymptote. It shows how reproductive output might increase and then
decrease, following a more smoothed, sigmoid curve.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>x</mi></msub><mo>=</mo><mi>A</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>e</mi><mi>x</mi><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mi>k</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>−</mo><msub><mi>x</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_x = A  (1 - exp(-k  (x - x_0)))</annotation></semantics></math>
</li>
<li>Normal : Reproductive output is modelled as normal distribution to
describe how reproductive output increases, peaks, and then decreases in
a bell curve around a mean age of reproductive capacity.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>x</mi></msub><mo>=</mo><mi>A</mi><mo>×</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>−</mi><mfrac><mn>1</mn><mn>2</mn></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mi>x</mi><mo>−</mo><mi>μ</mi></mrow><mi>σ</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mspace width="0.167em"></mspace><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_x = A \times \exp\left(-\frac{1}{2}\left(\frac{x-\mu}{\sigma}\right)^{2}\,\right)</annotation></semantics></math>
</li>
<li>Hadwiger: The outcomes of this model is qualitatively similar to the
normal distribution.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>x</mi></msub><mo>=</mo><mfrac><mrow><mi>a</mi><mi>b</mi></mrow><mi>C</mi></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mi>C</mi><mi>x</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mfrac><mn>3</mn><mn>2</mn></mfrac></msup><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mi>−</mi><msup><mi>b</mi><mn>2</mn></msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mi>C</mi><mi>x</mi></mfrac><mo>+</mo><mfrac><mi>x</mi><mi>C</mi></mfrac><mo>−</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">}</mo></mrow></mrow><annotation encoding="application/x-tex">f_x = \frac{ab}{C} \left (\frac{C}{x}  \right )^\frac{3}{2} \exp \left \{ -b^2  \left ( \frac{C}{x}+\frac{x}{C}-2 \right ) \right \}</annotation></semantics></math>
</li>
</ul>
<p><img src="generate_leslie_models_files/figure-html/unnamed-chunk-3-1.png" width="768"></p>
<p>Collectively, these mortality and reproduction functions offer a
large scope for modelling the variety of demographic trajectories
apparent across the tree of life.</p>
</div>
<div class="section level2">
<h2 id="trajectories-of-mortality-and-reproductive-output-and-production-of-life-tables">2. Trajectories of mortality and reproductive output, and production
of life tables<a class="anchor" aria-label="anchor" href="#trajectories-of-mortality-and-reproductive-output-and-production-of-life-tables"></a>
</h2>
<p>To obtain a trajectory of mortality, users can use the
<code>model_mortality</code> function, which takes as input the
parameters of a specified mortality model. The output of this function
is a standard life table <code>data.frame</code> including columns for
age (<code>x</code>), age-specific hazard (<code>hx</code>),
survivorship (<code>lx</code>), age-specific probability of death and
survival (<code>qx</code> and <code>px</code>). By default, the life
table is truncated at the age when the survivorship function declines
below 0.01 (i.e. when only 1% of individuals in a cohort would remain
alive).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">lt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_survival.html">model_mortality</a></span><span class="op">(</span>params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>b_0 <span class="op">=</span> <span class="fl">0.1</span>, b_1 <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>, model <span class="op">=</span> <span class="st">"Gompertz"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;     x        hx         lx        qx        px</span></span>
<span><span class="co">#&gt; 1   0 0.1000000 1.00000000 0.1051240 0.8948760</span></span>
<span><span class="co">#&gt; 2   1 0.1221403 0.89487598 0.1268617 0.8731383</span></span>
<span><span class="co">#&gt; 3   2 0.1491825 0.78135045 0.1526972 0.8473028</span></span>
<span><span class="co">#&gt; 4   3 0.1822119 0.66204041 0.1832179 0.8167821</span></span>
<span><span class="co">#&gt; 5   4 0.2225541 0.54074272 0.2190086 0.7809914</span></span>
<span><span class="co">#&gt; 6   5 0.2718282 0.42231542 0.2606027 0.7393973</span></span>
<span><span class="co">#&gt; 7   6 0.3320117 0.31225886 0.3084127 0.6915873</span></span>
<span><span class="co">#&gt; 8   7 0.4055200 0.21595427 0.3626343 0.6373657</span></span>
<span><span class="co">#&gt; 9   8 0.4953032 0.13764186 0.4231275 0.5768725</span></span>
<span><span class="co">#&gt; 10  9 0.6049647 0.07940180 0.4892807 0.5107193</span></span>
<span><span class="co">#&gt; 11 10 0.7389056 0.04055203 0.5598781 0.4401219</span></span>
<span><span class="co">#&gt; 12 11 0.9025013 0.01784784 0.6330059 0.3669941</span></span></code></pre></div>
<p>It can be useful to explore the impact of parameters on the mortality
hazard (<code>hx</code>) graphically, especially for users who are
unfamiliar with the chosen models.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">lt1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">hx</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Gompertz mortality (b_0 = 0.1, b_1 = 0.2)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="generate_leslie_models_files/figure-html/unnamed-chunk-5-1.png" width="768"></p>
<p>The <code>model_reproduction</code> function is similar to the
<code>model_mortality</code> function, as it has arguments for the type
of reproduction model, and its parameters. However, the output of the
<code>model_reproduction</code> function is a vector of reproductive
output values rather than a <code>data.frame</code>. This allows us to
add a reproduction column (<code>reproduction</code>) directly to the
life table produced earlier, as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">lt1</span> <span class="op">&lt;-</span> <span class="va">lt1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>reproduction <span class="op">=</span> <span class="fu"><a href="../reference/model_reproduction.html">model_reproduction</a></span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="va">x</span>, params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>    maturity <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"step"</span></span>
<span>  <span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;     x        hx         lx        qx        px reproduction</span></span>
<span><span class="co">#&gt; 1   0 0.1000000 1.00000000 0.1051240 0.8948760            0</span></span>
<span><span class="co">#&gt; 2   1 0.1221403 0.89487598 0.1268617 0.8731383            0</span></span>
<span><span class="co">#&gt; 3   2 0.1491825 0.78135045 0.1526972 0.8473028            0</span></span>
<span><span class="co">#&gt; 4   3 0.1822119 0.66204041 0.1832179 0.8167821            3</span></span>
<span><span class="co">#&gt; 5   4 0.2225541 0.54074272 0.2190086 0.7809914            3</span></span>
<span><span class="co">#&gt; 6   5 0.2718282 0.42231542 0.2606027 0.7393973            3</span></span>
<span><span class="co">#&gt; 7   6 0.3320117 0.31225886 0.3084127 0.6915873            3</span></span>
<span><span class="co">#&gt; 8   7 0.4055200 0.21595427 0.3626343 0.6373657            3</span></span>
<span><span class="co">#&gt; 9   8 0.4953032 0.13764186 0.4231275 0.5768725            3</span></span>
<span><span class="co">#&gt; 10  9 0.6049647 0.07940180 0.4892807 0.5107193            3</span></span>
<span><span class="co">#&gt; 11 10 0.7389056 0.04055203 0.5598781 0.4401219            3</span></span>
<span><span class="co">#&gt; 12 11 0.9025013 0.01784784 0.6330059 0.3669941            3</span></span></code></pre></div>
<p>Again, it can be useful to plot the relevant data to visualise
it.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">lt1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">reproduction</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Step reproduction, maturity at age 3"</span><span class="op">)</span></span></code></pre></div>
<p><img src="generate_leslie_models_files/figure-html/unnamed-chunk-7-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="from-life-table-to-mpm">3. From life table to MPM<a class="anchor" aria-label="anchor" href="#from-life-table-to-mpm"></a>
</h2>
<p>Users can now turn these life tables, containing age-specific
survival and reproductive trajectories, into Leslie matrices using the
<code>make_leslie_mpm</code> function. These MPMs can be large or small
depending on the maximum life span of the population: as mentioned
above, the population is modelled until less than 1% of a cohort remains
alive.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/make_leslie_mpm.html">make_leslie_mpm</a></span><span class="op">(</span>lifetable <span class="op">=</span> <span class="va">lt1</span><span class="op">)</span></span>
<span><span class="co">#&gt;           [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]</span></span>
<span><span class="co">#&gt;  [1,] 0.000000 0.0000000 0.0000000 3.0000000 3.0000000 3.0000000 3.0000000</span></span>
<span><span class="co">#&gt;  [2,] 0.894876 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt;  [3,] 0.000000 0.8731383 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt;  [4,] 0.000000 0.0000000 0.8473028 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt;  [5,] 0.000000 0.0000000 0.0000000 0.8167821 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt;  [6,] 0.000000 0.0000000 0.0000000 0.0000000 0.7809914 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt;  [7,] 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.7393973 0.0000000</span></span>
<span><span class="co">#&gt;  [8,] 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.6915873</span></span>
<span><span class="co">#&gt;  [9,] 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt; [10,] 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt; [11,] 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt; [12,] 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt;            [,8]      [,9]     [,10]     [,11]     [,12]</span></span>
<span><span class="co">#&gt;  [1,] 3.0000000 3.0000000 3.0000000 3.0000000 3.0000000</span></span>
<span><span class="co">#&gt;  [2,] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt;  [3,] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt;  [4,] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt;  [5,] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt;  [6,] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt;  [7,] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt;  [8,] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt;  [9,] 0.6373657 0.0000000 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt; [10,] 0.0000000 0.5768725 0.0000000 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt; [11,] 0.0000000 0.0000000 0.5107193 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt; [12,] 0.0000000 0.0000000 0.0000000 0.4401219 0.3669941</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="producing-sets-of-mpms-based-on-defined-model-characteristics">4. Producing sets of MPMs based on defined model
characteristics<a class="anchor" aria-label="anchor" href="#producing-sets-of-mpms-based-on-defined-model-characteristics"></a>
</h2>
<p>It is sometimes desirable to create large numbers of MPMs with
particular properties in order to test hypotheses. For Leslie MPMs, this
can be implemented in a straightforward way using the function
<code>rand_leslie_set</code>. This function generates a set of Leslie
MPMs based on defined mortality and reproduction models, and using model
parameters that are randomly drawn from specified distributions. For
example, users may wish to generate MPMs for Gompertz models to explore
how rate of senescence influences population dynamics.</p>
<p>Users must first set up a data frame describing the distribution from
which parameters will be drawn at random. The data frame has a number of
rows equal to the number of parameters in the model, and two values to
describe the distribution. In the case of a uniform distribution, these
are the minimum and maximum parameter values, respectively and with a
normal distribution they represent the mean and standard deviation. The
parameters should be entered in the order they appear in the model
equations (see <code><a href="../reference/model_survival.html">?model_mortality</a></code>), with the exact order
depending on the chosen mortality model.</p>
<p>For the Gompertz-Makeham model:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>x</mi></msub><mo>=</mo><msub><mi>b</mi><mn>0</mn></msub><msup><mi mathvariant="normal">e</mi><mrow><msub><mi>b</mi><mn>1</mn></msub><mi>x</mi></mrow></msup><mo>+</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">h_x = b_0 \mathrm{e}^{b_1  x} + c</annotation></semantics></math></p>
<p>The <code>output</code> argument defines the output as one of six
types (<code>Type1</code> through <code>Type6</code>). These outputs
include <code>CompadreDB</code> objects or <code>list</code> objects,
and the MPMs can be split into the component submatrices
(<strong>U</strong> and <strong>F</strong>, where the MPM,
<strong>A</strong> = <strong>U</strong> + <strong>F</strong>). In the
special case <code>Type6</code> the outputs are provided as a
<code>list</code> of life tables rather than MPMs. If the output is set
as a <code>CompadreDB</code> object, the mortality and reproduction
model parameters used to generate the MPM are included as metadata.</p>
<p>The following example illustrates the production of 50 Leslie MPMs
output to a <code>CompadreDB</code> object based on the Gompertz-Makeham
mortality model and a step reproduction model with maturity beginning at
age 0. An optional argument, <code>scale_output = TRUE</code> will scale
the reproduction in the output MPMs to ensure that population growth
rate is lambda. The scaling algorithm multiplies the reproduction part
of the MPM (the <strong>F</strong> submatrix) by a simple scaling factor
to ensure the population growth rate is 1 while maintaining the shape
(but not the magnitude) of the reproduction trajectory. This should be
used with care: The desirability of such a manipulation strongly depends
on the use the MPMs are put to.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mortParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  minVal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  maxVal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.15</span>, <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">reproductionParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  minVal <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  maxVal <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">maturityParam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">myMatrices</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rand_leslie_set.html">rand_leslie_set</a></span><span class="op">(</span></span>
<span>  n_models <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  mortality_model <span class="op">=</span> <span class="st">"GompertzMakeham"</span>,</span>
<span>  reproduction_model <span class="op">=</span> <span class="st">"step"</span>,</span>
<span>  mortality_params <span class="op">=</span> <span class="va">mortParams</span>,</span>
<span>  reproduction_params <span class="op">=</span> <span class="va">reproductionParams</span>,</span>
<span>  reproduction_maturity_params <span class="op">=</span> <span class="va">maturityParam</span>,</span>
<span>  dist_type <span class="op">=</span> <span class="st">"uniform"</span>,</span>
<span>  output <span class="op">=</span> <span class="st">"Type1"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; A COM(P)ADRE database ('CompadreDB') object with ?? SPECIES and 50 MATRICES.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 50 × 8</span></span></span>
<span><span class="co">#&gt;    mat        mortality_model      b_0    b_1     C reproduction_model     A</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> <span style="color: #949494;">&lt;CompdrMt&gt;</span> gompertzmakeham 0.045<span style="text-decoration: underline;">7</span>   0.141  0.129 step                8.64</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> <span style="color: #949494;">&lt;CompdrMt&gt;</span> gompertzmakeham 0.032<span style="text-decoration: underline;">1</span>   0.082<span style="text-decoration: underline;">7</span> 0.174 step                3.08</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> <span style="color: #949494;">&lt;CompdrMt&gt;</span> gompertzmakeham 0.032<span style="text-decoration: underline;">8</span>   0.109  0.146 step                7.75</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> <span style="color: #949494;">&lt;CompdrMt&gt;</span> gompertzmakeham 0.046<span style="text-decoration: underline;">7</span>   0.045<span style="text-decoration: underline;">8</span> 0.146 step                9.52</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> <span style="color: #949494;">&lt;CompdrMt&gt;</span> gompertzmakeham 0.048<span style="text-decoration: underline;">9</span>   0.026<span style="text-decoration: underline;">4</span> 0.147 step                6.48</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> <span style="color: #949494;">&lt;CompdrMt&gt;</span> gompertzmakeham 0.045<span style="text-decoration: underline;">2</span>   0.029<span style="text-decoration: underline;">4</span> 0.199 step                9.57</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> <span style="color: #949494;">&lt;CompdrMt&gt;</span> gompertzmakeham 0.004<span style="text-decoration: underline;">12</span>  0.082<span style="text-decoration: underline;">0</span> 0.139 step                9.25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> <span style="color: #949494;">&lt;CompdrMt&gt;</span> gompertzmakeham 0.022<span style="text-decoration: underline;">3</span>   0.127  0.174 step                8.49</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> <span style="color: #949494;">&lt;CompdrMt&gt;</span> gompertzmakeham 0.019<span style="text-decoration: underline;">4</span>   0.106  0.100 step                8.66</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> <span style="color: #949494;">&lt;CompdrMt&gt;</span> gompertzmakeham 0.000<span style="text-decoration: underline;">367</span> 0.039<span style="text-decoration: underline;">1</span> 0.191 step                6.89</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 40 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: reproduction_scaling &lt;dbl&gt;</span></span></span></code></pre></div>
<p>The function operates quite fast. For example, on an older MacBook
(3.10GHz Intel with 4 cores), it takes 17 seconds to generate 5000 MPMs
with the parameters mentioned above.</p>
<p>As an aid to assessing the simulation, users can produce a simple
summary of the MPMs using the <code>summarise_mpms</code> function.
Note, though, that this only works with <code>CompadreDB</code> outputs.
In this case, because we are working with Leslie MPMs, the dimension of
the MPMs is indicative of the maximum age reached by individuals in the
population.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summarise_mpms.html">summarise_mpms</a></span><span class="op">(</span><span class="va">myMatrices</span><span class="op">)</span></span>
<span><span class="co">#&gt; Summary of matrix dimension:</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   15.00   18.25   22.00   22.98   26.00   39.00 </span></span>
<span><span class="co">#&gt; Summary of lambda values:</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   2.845   6.010   7.970   7.557   9.150  10.672 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Summary of maximum F values:</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   2.002   5.157   7.142   6.720   8.327   9.788 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Summary of maximum U values:</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;  0.7829  0.8159  0.8347  0.8365  0.8545  0.8925 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Summary of minimum non-zero U values:</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;  0.5715  0.6881  0.7650  0.7514  0.8160  0.8814</span></span></code></pre></div>
<p>After producing the output as a <code>CompadreDB</code> object, the
matrices can be accessed using functions from the <code>RCompadre</code>
R package. For example, to get the A matrix, or the U/F submatrices
users can use the <code>matA</code>, <code>matU</code> or
<code>matF</code> functions. The following code illustrates how to
rapidly calculate population growth rate for all of the matrices.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Obtain the matrices</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html" class="external-link">matA</a></span><span class="op">(</span><span class="va">myMatrices</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate lambda for each matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu">popdemo</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/popdemo/man/eigs.html" class="external-link">eigs</a></span>, what <span class="op">=</span> <span class="st">"lambda"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1]  9.480062  3.889616  8.587381 10.343567  7.303660 10.356146 10.112353</span></span>
<span><span class="co">#&gt;  [8]  9.308862  9.549256  7.720332 10.672096  7.928430  5.604869  8.872518</span></span>
<span><span class="co">#&gt; [15]  6.966830  7.339943  9.468459  3.993036  8.631979  2.871674  8.012464</span></span>
<span><span class="co">#&gt; [22]  3.567593  2.844529  8.688251  7.778629  5.968972  8.664013  9.523154</span></span>
<span><span class="co">#&gt; [29]  7.123514  9.482587  7.556071 10.495633  7.644149  7.441366  7.792883</span></span>
<span><span class="co">#&gt; [36]  9.092281 10.412818  5.422186  9.018497  8.325535  4.386485  5.377892</span></span>
<span><span class="co">#&gt; [43]  6.131147  3.940014  8.952296  4.907484  9.138780  9.154187  3.317446</span></span>
<span><span class="co">#&gt; [50]  8.668165</span></span></code></pre></div>
<p>Users can examine the vignettes for the <code>Rcompadre</code> and
<code>Rage</code> packages for additional insight into other potential
operations with the <code>compadreDB</code> object.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This vignette demonstrated how to generate Leslie matrices using
functional forms of mortality and reproduction, allowing users to
simulate virtual species with varied life histories. These matrices can
be used to explore how life history or parameter differences affect
population dynamics, supporting various research and educational
applications.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Owen Jones.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
